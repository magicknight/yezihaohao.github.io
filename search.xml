<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Javascript项目笔记]]></title>
      <url>https://yezihaohao.github.io/2017/03/13/Javascript%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<h3 id="针对项目中常用的javascript-api等，进行一个汇总"><a href="#针对项目中常用的javascript-api等，进行一个汇总" class="headerlink" title="针对项目中常用的javascript api等，进行一个汇总~"></a>针对项目中常用的javascript api等，进行一个汇总~</h3><p>文档持续更新中。。。</p>
<blockquote>
<p>前提：有些功能可能浏览器还不支持，需要用babel进行转换，具体的babel环境搭建，请自行Baidu或google。<br>  很多框架的脚手架生成的helloworld项目是已经搭好的环境，比如react或者vue，所以使用脚手架的童鞋大可放心使用。<br>  若有问题可加群264591039与我讨论。</p>
</blockquote>
<h3 id="扩展运算符：三个点-…"><a href="#扩展运算符：三个点-…" class="headerlink" title="扩展运算符：三个点 …"></a>扩展运算符：三个点 …</h3><h4 id="合并数组"><a href="#合并数组" class="headerlink" title="合并数组"></a>合并数组</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> arr1 = [1, 2], arr2 = [3, 4];</div><div class="line">arr1.push(...arr2);  // 把arr2合并到arr1的尾部, arr1改变</div><div class="line">arr1.unshift(...arr2);   // 把arr2合并到arr1的顶部, arr1改变</div><div class="line">[...arr1, ...arr2];  // 生成一个由arr1和arr2组成的新数组，原数组不变</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/jsdemo1.gif" alt="截图"></p>
<h4 id="复制对象"><a href="#复制对象" class="headerlink" title="复制对象"></a>复制对象</h4><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let obj = &#123;a: 1&#125;;</div><div class="line">&#123;...obj, b: 2&#125;;     // 返回一个新的对象，&#123;a: 1, b: 2&#125;, obj对象不变</div><div class="line">// 等价于下面的用法</div><div class="line">Object.assign(&#123;&#125;, obj, &#123;b: 2&#125;);     // 返回一个新的对象，&#123;a: 1, b: 2&#125;,  obj对象不变</div><div class="line">// 另外Object.assign 还有一个用法</div><div class="line">Object.assign(obj, &#123;b: 2&#125;);      // 返回obj对象并且新增加了b属性：&#123;a: 1, b: 2&#125;  obj对象改变</div><div class="line">// 由于使用的chrome浏览器还不支持第一种用法，只能演示Object.assign。项目中使用babel转换</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/jsdemo3.gif" alt="截图"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Socket.io+Notification实现浏览器消息推送]]></title>
      <url>https://yezihaohao.github.io/2017/02/20/Socket-io-Notification%E5%AE%9E%E7%8E%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>socket.io: 包含对websocket的封装，可实现服务端和客户端之前的通信。详情见<a href="http://socket.io" target="_blank" rel="external">官网</a> (虽然是英文文档，但还是通俗易懂)。<br>  Notification: Html5新特性，用于浏览器的桌面通知，只有部分浏览器支持。<br>  通过nodejs+Socket.io+Notification实现服务端往浏览器客户端发送自定义消息。<br>  若有问题可加群264591039与我讨论。<br>  转载请注明出处！</p>
</blockquote>
<h3 id="开发前提"><a href="#开发前提" class="headerlink" title="开发前提"></a>开发前提</h3><p>本地安装nodejs以及npm<br>对nodejs以及express框架有一定了解。（本篇将和官方文档一样，采用express 4.10.2）</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><ul>
<li>新建一个文件夹notification（以下操作都在该文件夹的根目录进行）</li>
<li>npm初始化package.json文件 <code>npm init</code></li>
<li>安装express(指定版本4.10.2，没有试过其他版本，感兴趣可以试下) <code>npm install --save express@4.10.2</code></li>
<li>安装socket.io(本人安装的版本是1.7.3) <code>npm install --save socket.io</code></li>
</ul>
<h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><h4 id="构建通信环境"><a href="#构建通信环境" class="headerlink" title="构建通信环境"></a>构建通信环境</h4><p>在根目录下新建一个index.html（注：index页面的样式来自socket.io的官方示例）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;!doctype html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;title&gt;Socket.IO Notification&lt;/title&gt;</div><div class="line">    &lt;style&gt;</div><div class="line">      * &#123; margin: 0; padding: 0; box-sizing: border-box; &#125;</div><div class="line">      body &#123; font: 13px Helvetica, Arial; &#125;</div><div class="line">      form &#123; background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; &#125;</div><div class="line">      form input &#123; border: 0; padding: 10px; width: 90%; margin-right: .5%; &#125;</div><div class="line">      form button &#123; width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; &#125;</div><div class="line">      #messages &#123; list-style-type: none; margin: 0; padding: 0; &#125;</div><div class="line">      #messages li &#123; padding: 5px 10px; &#125;</div><div class="line">      #messages li:nth-child(odd) &#123; background: #eee; &#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;ul id=&quot;messages&quot;&gt;&lt;/ul&gt;</div><div class="line">    &lt;form action=&quot;&quot;&gt;</div><div class="line">      &lt;input id=&quot;m&quot; autocomplete=&quot;off&quot; /&gt;&lt;button&gt;Send&lt;/button&gt;</div><div class="line">    &lt;/form&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>新建一个index.js文件，并在js文件中构建相应的对象和变量，创建监听端口为8080 的服务器，以及添加映射到index.html的路由。<br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> express = require(<span class="string">'express'</span>),</div><div class="line">	app = express(),</div><div class="line">	http = require(<span class="string">'http'</span>).Server(app),</div><div class="line">	io = require(<span class="string">'socket.io'</span>)(http);</div><div class="line">app.use(express.static(__dirname + <span class="string">'/public'</span>));</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="keyword">function</span>(req, res)&#123;</div><div class="line">	res.sendfile(<span class="string">'index.html'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">http.listen(8080, <span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">	console.log(<span class="string">'listening on port 8080'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>运行 <code>node index.js</code> 用浏览器打开<a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a> 成功的话即可看到index.html页面的内容。<br>在index.js的监听端口代码上方添加socket.io的监听事件，监听用户连接的connection。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">io.on(<span class="string">'connection'</span>, <span class="keyword">function</span>(socket)&#123;</div><div class="line">	console.log(<span class="string">'a user connected'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>创建监听Event事件:notification，并用emit向客户端推送消息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">io.on(<span class="string">'connection'</span>, <span class="keyword">function</span>(socket)&#123;</div><div class="line">	console.log(<span class="string">'a user connected'</span>);</div><div class="line">	socket.on(<span class="string">'notification'</span>, <span class="keyword">function</span>(msg)&#123;</div><div class="line">		console.log(msg);</div><div class="line">	 	io.emit(<span class="string">'notification'</span>, msg);</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在index.html页面中的上方引入socket.io文件，并用emit向服务器提交数据以及监听事件notification，接收服务器推送的消息<br>注意，引入socket.io的方式在运行<code>node index.js</code>之后才有效果，直接打开index.html是找不到这个文件的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  &lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"/socket.io/socket.io.js"</span>&gt;&lt;/script&gt;</div><div class="line">  &lt;script src=<span class="string">"http://code.jquery.com/jquery-1.11.1.js"</span>&gt;&lt;/script&gt;</div><div class="line">  &lt;script&gt;</div><div class="line"><span class="built_in">let</span> socket = io();</div><div class="line">$(<span class="string">'form'</span>).submit(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">	socket.emit(<span class="string">'notification'</span>, $(<span class="string">'#m'</span>).val());</div><div class="line">	$(<span class="string">'#m'</span>).val(<span class="string">''</span>);</div><div class="line">	<span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">&#125;);</div><div class="line">socket.on(<span class="string">'notification'</span>, <span class="keyword">function</span>(msg)&#123;</div><div class="line">	console.log(msg);</div><div class="line">&#125;);</div><div class="line">  &lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>浏览器打开<a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a> 后，在input框中输入，点击发送，在nodejs运行的控制台可以看到如下信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a user connected //以下数据是输入框输入的数据</div><div class="line">hello   </div><div class="line"><span class="built_in">test</span></div><div class="line">测试</div></pre></td></tr></table></figure></p>
<h4 id="实现自定义消息推送"><a href="#实现自定义消息推送" class="headerlink" title="实现自定义消息推送"></a>实现自定义消息推送</h4><p>完整代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">  &lt;script&gt;</div><div class="line"><span class="built_in">let</span> socket = io();</div><div class="line">$(<span class="string">'form'</span>).submit(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">	socket.emit(<span class="string">'notification'</span>, $(<span class="string">'#m'</span>).val());</div><div class="line">	$(<span class="string">'#m'</span>).val(<span class="string">''</span>);</div><div class="line">	<span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">&#125;);</div><div class="line">socket.on(<span class="string">'notification'</span>, <span class="keyword">function</span>(msg)&#123;</div><div class="line">	notice(msg);    //若允许通知，待输入消息后监听变化就会调用通知方法</div><div class="line">&#125;);</div><div class="line"></div><div class="line">   Notification.requestPermission(<span class="keyword">function</span>(permission) &#123;&#125;);    //询问浏览器是否允许通知</div><div class="line">    </div><div class="line"><span class="keyword">function</span> notice(msg) &#123;  </div><div class="line">	<span class="built_in">let</span> _notification = new Notification(`消息通知`,&#123;</div><div class="line">		body:`<span class="variable">$&#123;msg&#125;</span>`,</div><div class="line">		icon:<span class="string">'http://localhost:8080/23539868.jpg'</span></div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	<span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">		_notification.close(); //设置5秒后自动关闭通知框</div><div class="line">	&#125;,5000);</div><div class="line">  </div><div class="line">&#125;</div><div class="line">  &lt;/script&gt;</div></pre></td></tr></table></figure></p>
<h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p>完整示例代码见<a href="https://github.com/yezihaohao/notification" target="_blank" rel="external">GitHub</a></p>
<p><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/TEST.gif" alt="截图"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Vuejs2.X组件化-阿里的G2图表组件]]></title>
      <url>https://yezihaohao.github.io/2017/02/14/Vuejs2-X%E7%BB%84%E4%BB%B6%E5%8C%96-%E9%98%BF%E9%87%8C%E7%9A%84G2%E5%9B%BE%E8%A1%A8%E7%BB%84%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>vue 的组件化开发是一个非常不错的机制.’一处开发,多处引用’，不仅降低的维护成本，提高了开发效率，而且单独的组件有单独的视图和交互数据逻辑，使得系统层次更加分明。若有问题可加群264591039与我讨论~转载文章请标明出处！</p>
</blockquote>
<h3 id="开发场景"><a href="#开发场景" class="headerlink" title="开发场景"></a>开发场景</h3><p>数据可视化是我们互联网常见的功能，所以难免我们会在项目中插入图表等，找到一个还算可以的图形插件，阿里的G2图形库，详情请参见<a href="https://antv.alipay.com/g2/doc/" target="_blank" rel="external">G2官网</a>。接下来就开始我们的Vue G2组件化之旅。</p>
<h3 id="脚手架搭建helloworld"><a href="#脚手架搭建helloworld" class="headerlink" title="脚手架搭建helloworld"></a>脚手架搭建helloworld</h3><p>先用脚手架工具 vue-cli搭建一个vue的helloworld项目(Vue的相关教程请看<a href="https://cn.vuejs.org" target="_blank" rel="external">Vue官网</a>)，按照readme文档正常运行该项目。</p>
<h3 id="安装G2插件"><a href="#安装G2插件" class="headerlink" title="安装G2插件"></a>安装G2插件</h3><p>在package.json的目录下用npm包管理工具安装G2插件库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev g2</div></pre></td></tr></table></figure></p>
<p>我用到的版本是2.2.1，现在最新的好像是2.2.2，应该也没什么问题，不过我没测试过</p>
<h3 id="新建G2Line-vue单文件组件"><a href="#新建G2Line-vue单文件组件" class="headerlink" title="新建G2Line.vue单文件组件"></a>新建G2Line.vue单文件组件</h3><p>在components目录下新建G2Line.vue文件（当前是以线形图为例的组件）。<br>在template标签中新增标签<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;template&gt;</div><div class="line">  &lt;!--此处的id用变量，方便同一页面引用多次相同的组件--&gt;</div><div class="line">  &lt;div :id=<span class="string">"id"</span>&gt;&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>在script标签中引入G2并开始先关操作代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">import G2 from <span class="string">'g2'</span>;</div><div class="line">  <span class="built_in">export</span> default &#123;</div><div class="line">    <span class="function"><span class="title">data</span></span> () &#123;</div><div class="line">      <span class="built_in">return</span> &#123;</div><div class="line">        chart: null</div><div class="line">      &#125;;</div><div class="line">    &#125;,</div><div class="line">    props: &#123;</div><div class="line">      charData: &#123;</div><div class="line">        <span class="built_in">type</span>: Array,</div><div class="line">        default: <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">          <span class="built_in">return</span> &#123;</div><div class="line">            data: [&#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-11"</span>, <span class="string">'value'</span>: 9275501&#125;,  // 测试数据，根据自己需求自己设置数据</div><div class="line">              &#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-12"</span>, <span class="string">'value'</span>: 9281904&#125;,</div><div class="line">              &#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-13"</span>, <span class="string">'value'</span>: 9290777&#125;,</div><div class="line">              &#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-14"</span>, <span class="string">'value'</span>: 9297913&#125;,</div><div class="line">              &#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-15"</span>, <span class="string">'value'</span>: 9306918&#125;,</div><div class="line">              &#123;<span class="string">'mzkId'</span>: 112, <span class="string">'strftime'</span>: <span class="string">"2017-01-16"</span>, <span class="string">'value'</span>: 9315641&#125;]</div><div class="line">          &#125;;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      id: String</div><div class="line">    &#125;,</div><div class="line">    mounted: <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">//      this.drawChart();       // 第一步想到的是创建的时候更新图表，但是这个不适用于异步请求接口获取相关数据，所以采用下面的监听的方式</div><div class="line">    &#125;,</div><div class="line">    beforeUpdate: <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">//      this.drawChart();</div><div class="line">    &#125;,</div><div class="line">    watch: &#123;</div><div class="line">      charData: <span class="keyword">function</span> (val, oldVal) &#123;    // 监听charData，当放生变化时，触发这个回调函数绘制图表</div><div class="line">        console.log(<span class="string">'new: %s, old: %s'</span>, val, oldVal);</div><div class="line">        this.drawChart(val);</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    methods: &#123;</div><div class="line">      drawChart: <span class="keyword">function</span> (datas) &#123;</div><div class="line">        // 如果图形存在则删除再创建，这个地方感觉稍微有点坑</div><div class="line">        // 具体的G2 api函数说明请看上面提供的官网地址，此处不再逐一说明</div><div class="line">        this.chart &amp;&amp; this.chart.destroy();</div><div class="line">        <span class="built_in">let</span> data = datas;</div><div class="line">        this.chart = new G2.Chart(&#123;</div><div class="line">          id: this.id,</div><div class="line">          width: 1000,</div><div class="line">          height: 250</div><div class="line">        &#125;);</div><div class="line">        this.chart.source(data, &#123;</div><div class="line">          strftime: &#123;</div><div class="line">            <span class="built_in">alias</span>: <span class="string">'日期'</span>,</div><div class="line">            <span class="built_in">type</span>: <span class="string">'cat'</span>,</div><div class="line">            range: [0, 1]</div><div class="line">          &#125;,</div><div class="line">          value: &#123;</div><div class="line">            <span class="built_in">alias</span>: <span class="string">'数量值(人)'</span></div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">        this.chart.line().position(<span class="string">'strftime*value'</span>).size(2);</div><div class="line">        this.chart.point().position(<span class="string">'strftime*value'</span>).color(<span class="string">'#757373'</span>)</div><div class="line">          .shape(<span class="string">'circle'</span>)</div><div class="line">          .label(<span class="string">'value'</span>, &#123;offset: 20, label: &#123;fill: <span class="string">'#000'</span>&#125;&#125;);</div><div class="line">        this.chart.animate(<span class="literal">false</span>);</div><div class="line">        this.chart.render();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h3 id="App-vue引入组件并渲染图表"><a href="#App-vue引入组件并渲染图表" class="headerlink" title="App.vue引入组件并渲染图表"></a>App.vue引入组件并渲染图表</h3><p>在app.vue中引入上一步新建的G2Line.vue组件，并加载到当前vue实例中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    import G2Line from <span class="string">'./components/G2Line.vue'</span>;</div><div class="line">    <span class="built_in">export</span> default &#123;</div><div class="line">        components: &#123;</div><div class="line">            G2Line</div><div class="line">        &#125;,</div><div class="line">        <span class="function"><span class="title">data</span></span> () &#123;</div><div class="line">            <span class="built_in">return</span> &#123;</div><div class="line">                serverData: []</div><div class="line">            &#125; </div><div class="line">        &#125;,</div><div class="line">        methods: &#123;</div><div class="line">            // 此处省略从服务器获取数据并且赋值给this.serverData</div><div class="line">            // 推荐使用axios请求接口</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>获取服务端数据之后，在template中创建组件标签，并将serverData发送给子组件G2Line<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--同步设置id传送给子组件--&gt;</div><div class="line">&lt;g2-line :charData=<span class="string">"serverData"</span> :id=<span class="string">"'c1'"</span> id=<span class="string">"c1"</span>&gt;&lt;/g2-line&gt;</div></pre></td></tr></table></figure></p>
<h3 id="刷新界面，成功看到页面图表的渲染"><a href="#刷新界面，成功看到页面图表的渲染" class="headerlink" title="刷新界面，成功看到页面图表的渲染"></a>刷新界面，成功看到页面图表的渲染</h3><p><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/g2%E6%88%AA%E5%9B%BE.gif" alt="截图"><br><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/g2截图2.gif" alt="截图"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Nodejs爬虫--抓取豆瓣电影网页数据（下）]]></title>
      <url>https://yezihaohao.github.io/2017/02/11/Nodejs%E7%88%AC%E8%99%AB-%E6%8A%93%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%BD%91%E9%A1%B5%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
      <content type="html"><![CDATA[<blockquote>
<p>接着上篇 <a href="https://yezihaohao.github.io/2017/02/09/Nodejs%E7%88%AC%E8%99%AB-%E6%8A%93%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%BD%91%E9%A1%B5%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%8A%EF%BC%89/">Nodejs爬虫–抓取豆瓣电影网页数据（上）</a><br>  本篇主要描述将上次抓取的数据存入mongodb数据库<br>  前提：百度或谷歌mongodb的安装教程，安装本地并成功运行<br>  推荐一款mongodb数据库可视化管理工具：Robomongo。可以加群264591039获取安装包或自行寻找资源</p>
</blockquote>
<h3 id="首先用npm安装第三方数据库操作包：mongoose"><a href="#首先用npm安装第三方数据库操作包：mongoose" class="headerlink" title="首先用npm安装第三方数据库操作包：mongoose."></a>首先用npm安装第三方数据库操作包：mongoose.</h3><p>关于mongoose详情请查看<a href="http://mongoosejs.com/index.html" target="_blank" rel="external">官方文档</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev mongoose</div></pre></td></tr></table></figure></p>
<h3 id="引入mongoose包开始对mongodb进行管理"><a href="#引入mongoose包开始对mongodb进行管理" class="headerlink" title="引入mongoose包开始对mongodb进行管理"></a>引入mongoose包开始对mongodb进行管理</h3><p>当前目录下新建一个mongo.js文件方便管理，在该文件中引入相关包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> mongoose = require(<span class="string">'mongoose'</span>),</div><div class="line">    assert = require(<span class="string">'assert'</span>);</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="获取表构造器Schema并映射mongodb相应的collection"><a href="#获取表构造器Schema并映射mongodb相应的collection" class="headerlink" title="获取表构造器Schema并映射mongodb相应的collection"></a>获取表构造器Schema并映射mongodb相应的collection</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> Schema = mongoose.Schema;</div><div class="line"></div><div class="line"><span class="built_in">let</span> filmSchema = new Schema(&#123;       //自定义相应的表数据字段</div><div class="line">        title: String,</div><div class="line">        <span class="built_in">type</span>: String,</div><div class="line">        directories: String,</div><div class="line">        scriptwriter: String,</div><div class="line">        actors: String</div><div class="line">    &#125;);</div><div class="line">//映射collection并生成model对象用于管理数据表的增删改查</div><div class="line">//默认是映射到名为films的collection</div><div class="line">//若自定义表明则：<span class="built_in">let</span> filmSchema = new Schema(&#123;..&#125;, &#123; collection: <span class="string">'data'</span> &#125;);  <span class="string">'data'</span>即为自定义名称</div><div class="line"><span class="built_in">let</span> Film = mongoose.model(<span class="string">'Film'</span>, filmSchema);</div></pre></td></tr></table></figure>
<h3 id="连接mongodb数据库并exports-Film对象"><a href="#连接mongodb数据库并exports-Film对象" class="headerlink" title="连接mongodb数据库并exports Film对象"></a>连接mongodb数据库并exports Film对象</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> db = mongoose.connect(<span class="string">'mongodb://127.0.0.1:27017/spider'</span>);</div><div class="line">db.connection.on(<span class="string">'error'</span>, (err) =&gt; &#123;</div><div class="line">    console.log(`数据库连接失败：<span class="variable">$&#123;err&#125;</span>`);</div><div class="line">&#125;);</div><div class="line">db.connection.on(<span class="string">'open'</span>, () =&gt; &#123;</div><div class="line">    console.log(<span class="string">'数据库连接成功'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = &#123;Film: Film&#125;;</div></pre></td></tr></table></figure>
<h3 id="在spider-js中引入Film对象并添加入库操作代码"><a href="#在spider-js中引入Film对象并添加入库操作代码" class="headerlink" title="在spider.js中引入Film对象并添加入库操作代码"></a>在spider.js中引入Film对象并添加入库操作代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> mongo = require(<span class="string">'./mongo'</span>);</div><div class="line">//在请求网页的end函数中添加入库操作</div><div class="line">xxxx.end((err, res) =&gt; &#123;</div><div class="line">    var $ = cheerio.load(res.text);     //用cheerio获取整个页面DOM对象</div><div class="line">    var _data = &#123;title:<span class="string">''</span>, <span class="built_in">type</span>: <span class="string">''</span>, directories: <span class="string">''</span>, scriptwriter: <span class="string">''</span>, actors: <span class="string">''</span>&#125;;</div><div class="line">    _data.title = $(<span class="string">'#content h1 span'</span>).text();</div><div class="line">    _data.directories = $(<span class="string">'#info .attrs'</span>).eq(0).text();</div><div class="line">    _data.scriptwriter = $(<span class="string">'#info .attrs'</span>).eq(1).text();</div><div class="line">    _data.actors = $(<span class="string">'#info .attrs'</span>).eq(2).text();</div><div class="line">    $(<span class="string">'span[property="v:genre"]'</span>).each(<span class="keyword">function</span> (index) &#123;</div><div class="line">        _data.type += ($(this).text() + (index == $(<span class="string">'span[property="v:genre"]'</span>).length - 1 ? <span class="string">''</span> : <span class="string">'、'</span>));</div><div class="line">    &#125;);</div><div class="line">    console.log(_data);</div><div class="line">    mongo.Film.create(_data, (err, doc) =&gt; &#123;</div><div class="line">                        assert.equal(err, null);</div><div class="line">                        console.log(doc);</div><div class="line">                    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="运行spider-js，并查看数据库中的数据"><a href="#运行spider-js，并查看数据库中的数据" class="headerlink" title="运行spider.js，并查看数据库中的数据"></a>运行spider.js，并查看数据库中的数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">node spider.js</div><div class="line">//用上述提到的可视化工具查看数据库是否成功有数据入库</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/yezihaohao/yezihaohao.github.io/master/imgs/QQ%E6%88%AA%E5%9B%BE20170211120738.png" alt="数据库截图"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Javascript正则表达式整合]]></title>
      <url>https://yezihaohao.github.io/2017/02/10/Javascript%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%95%B4%E5%90%88/</url>
      <content type="html"><![CDATA[<h2 id="项目中常用正则表达式使用整合大全"><a href="#项目中常用正则表达式使用整合大全" class="headerlink" title="项目中常用正则表达式使用整合大全"></a>项目中常用正则表达式使用整合大全</h2><h3 id="提取网页标签内容"><a href="#提取网页标签内容" class="headerlink" title="提取网页标签内容"></a>提取网页标签内容</h3><h4 id="一-单个标签提取"><a href="#一-单个标签提取" class="headerlink" title="一.单个标签提取"></a>一.单个标签提取</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> str = `&lt;a class=<span class="string">"menu"</span>&gt;GitHub&lt;/a&gt;`;</div><div class="line"></div><div class="line"><span class="built_in">let</span> content = str.match(/&lt;a class=<span class="string">"menu"</span>&gt;([\s\S]+)&lt;\/a&gt;/)[1];</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="不定时更新中…"><a href="#不定时更新中…" class="headerlink" title="不定时更新中…"></a>不定时更新中…</h2>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Nodejs爬虫--抓取豆瓣电影网页数据（上）]]></title>
      <url>https://yezihaohao.github.io/2017/02/09/Nodejs%E7%88%AC%E8%99%AB-%E6%8A%93%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%BD%91%E9%A1%B5%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
      <content type="html"><![CDATA[<p>之前写了一个nodejs的开源爬虫小项目，补上博客详细解析下代码。</p>
<p><code>PS：</code>共有上下两篇，第一篇讲从网站上抓取数据，第二篇讲将抓取的数据存入mongodb数据库。</p>
<h2 id="我们快速开始吧"><a href="#我们快速开始吧" class="headerlink" title="我们快速开始吧"></a>我们快速开始吧</h2><h3 id="首先，安装nodejs，然后用npm工具初始化资源管理配置文件：package-json"><a href="#首先，安装nodejs，然后用npm工具初始化资源管理配置文件：package-json" class="headerlink" title="首先，安装nodejs，然后用npm工具初始化资源管理配置文件：package.json"></a>首先，安装nodejs，然后用npm工具初始化资源管理配置文件：package.json</h3><p>新建spider文件夹，在该文件夹下面初始化package.json<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm init</div></pre></td></tr></table></figure></p>
<h3 id="然后用npm安装相关库文件："><a href="#然后用npm安装相关库文件：" class="headerlink" title="然后用npm安装相关库文件："></a>然后用npm安装相关库文件：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev superagent cheerio eventproxy <span class="keyword">async</span></div></pre></td></tr></table></figure>
<p>在文件夹下面新建spider.js, 在文件中引入需要用到的nodejs模块如下(具体用法请查询网上相关资料)：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> superagent = <span class="built_in">require</span>(<span class="string">'superagent'</span>),     <span class="comment">//nodejs里面一个非常方便的客户端代理请求模块，支持get,post,put,delete等</span></div><div class="line">    cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>),           <span class="comment">//类似于jQuery的DOM操作模块，可以提取html中想要的信息</span></div><div class="line">    eventproxy = <span class="built_in">require</span>(<span class="string">'eventproxy'</span>),     <span class="comment">//控制异步请求并发，可以监听请求，使得某些请求完毕之后在发送请求</span></div><div class="line">    assert = <span class="built_in">require</span>(<span class="string">'assert'</span>),             <span class="comment">//异常抛出判断模块，assert.equal(err, null);  如果err不为null,则直接抛出异常</span></div><div class="line">    <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">'async'</span>);              <span class="comment">//控制请求并发连接数</span></div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="用superagent请求豆瓣的某个接口，并把所有的页面链接放到一个数组里面，用eventproxy控制监听该请求结束之后才开始请求相应的详情页面。"><a href="#用superagent请求豆瓣的某个接口，并把所有的页面链接放到一个数组里面，用eventproxy控制监听该请求结束之后才开始请求相应的详情页面。" class="headerlink" title="用superagent请求豆瓣的某个接口，并把所有的页面链接放到一个数组里面，用eventproxy控制监听该请求结束之后才开始请求相应的详情页面。"></a>用superagent请求豆瓣的某个接口，并把所有的页面链接放到一个数组里面，用eventproxy控制监听该请求结束之后才开始请求相应的详情页面。</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">superagent.get(URL)</div><div class="line">    .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> _pageUrls = [];</div><div class="line">        res.body.forEach(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</div><div class="line">           _pageUrls.push(val.url);</div><div class="line">        &#125;);</div><div class="line">        ep.emit(<span class="string">'pageUrls'</span>, _pageUrls);   <span class="comment">//监听相关实例，完成之后告诉pageUrls</span></div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<h3 id="监听事件完成之后，执行请求相应的豆瓣电影详情页面-并用async控制请求的并发量，可以降低请求的频率和速度"><a href="#监听事件完成之后，执行请求相应的豆瓣电影详情页面-并用async控制请求的并发量，可以降低请求的频率和速度" class="headerlink" title="监听事件完成之后，执行请求相应的豆瓣电影详情页面.并用async控制请求的并发量，可以降低请求的频率和速度"></a>监听事件完成之后，执行请求相应的豆瓣电影详情页面.并用async控制请求的并发量，可以降低请求的频率和速度</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> ep = eventproxy.create(<span class="string">'pageUrls'</span>, (pageUrls) =&gt; &#123;      <span class="comment">//创建一个监听实例</span></div><div class="line">    <span class="keyword">let</span> _http = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> _delay = <span class="built_in">parseInt</span>((<span class="built_in">Math</span>.random() * <span class="number">30000000</span>) % <span class="number">1000</span>, <span class="number">10</span>);   <span class="comment">//随机延时请求</span></div><div class="line">        superagent.get(url)</div><div class="line">            .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">                <span class="keyword">var</span> $ = cheerio.load(res.text);     <span class="comment">//用cheerio获取整个页面DOM对象</span></div><div class="line">                <span class="keyword">var</span> _data = &#123;<span class="attr">title</span>:<span class="string">''</span>, <span class="attr">type</span>: <span class="string">''</span>, <span class="attr">directories</span>: <span class="string">''</span>, <span class="attr">scriptwriter</span>: <span class="string">''</span>, <span class="attr">actors</span>: <span class="string">''</span>&#125;;</div><div class="line">                _data.title = $(<span class="string">'#content h1 span'</span>).text();</div><div class="line">                _data.directories = $(<span class="string">'#info .attrs'</span>).eq(<span class="number">0</span>).text();</div><div class="line">                _data.scriptwriter = $(<span class="string">'#info .attrs'</span>).eq(<span class="number">1</span>).text();</div><div class="line">                _data.actors = $(<span class="string">'#info .attrs'</span>).eq(<span class="number">2</span>).text();</div><div class="line">                $(<span class="string">'span[property="v:genre"]'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</div><div class="line">                    _data.type += ($(<span class="keyword">this</span>).text() + (index == $(<span class="string">'span[property="v:genre"]'</span>).length - <span class="number">1</span> ? <span class="string">''</span> : <span class="string">'、'</span>));</div><div class="line">                &#125;);</div><div class="line">                <span class="built_in">console</span>.log(_data);</div><div class="line">            &#125;);</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            callback(<span class="literal">null</span>, url);</div><div class="line">        &#125;, _delay);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">async</span>.mapLimit(pageUrls, <span class="number">3</span>, (url, callback) =&gt; &#123;  <span class="comment">//用async 的 mapLimit(arr, limit, iterator, callback) 接口控制请求并发量为3</span></div><div class="line">        _http(url, callback);</div><div class="line">    &#125;, (err, res) =&gt; &#123;</div><div class="line">        assert.equal(err, <span class="literal">null</span>);</div><div class="line">    &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="本章节结束，未完待续…下期是怎么将抓取的数据存入mongodb数据库！"><a href="#本章节结束，未完待续…下期是怎么将抓取的数据存入mongodb数据库！" class="headerlink" title="本章节结束，未完待续…下期是怎么将抓取的数据存入mongodb数据库！"></a>本章节结束，未完待续…下期是怎么将抓取的数据存入mongodb数据库！</h2>]]></content>
    </entry>
    
  
  
</search>
